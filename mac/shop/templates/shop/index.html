{% extends 'shop/basic.html' %}
{% block title %} MyAwesomeCart - Best E-Commerce Website {% endblock %}
{% block css %}
<style>
/* Modern CSS Reset and Base Styles */
:root {
  --primary: #4361ee;
  --primary-dark: #3a56d4;
  --secondary: #7209b7;
  --light: #f8f9fa;
  --dark: #212529;
  --success: #4cc9f0;
  --gray: #6c757d;
  --light-gray: #e9ecef;
  --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  --radius: 12px;
  --transition: all 0.3s ease;
}

* {
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  color: var(--dark);
  background-color: #f5f7fb;
  line-height: 1.6;
}

/* Container and Layout */
.container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 15px;
}

/* Flash Sale Header */
.flash-sale-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 2rem 0 1.5rem;
  padding: 1rem 1.5rem;
  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
  border-radius: var(--radius);
  color: white;
  box-shadow: var(--shadow);
}

.flash-sale-header h5 {
  margin: 0;
  font-size: 1.4rem;
  font-weight: 600;
}

.timer {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 500;
}

.timer span {
  background: rgba(255, 255, 255, 0.2);
  padding: 5px 10px;
  border-radius: 6px;
  font-weight: 600;
}

/* Carousel Styles */
.carousel-container {
  position: relative;
  margin-bottom: 3rem;
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow);
  background: white;
}

.carousel {
  padding: 1.5rem;
}

.carousel-inner {
  border-radius: var(--radius);
}

.carousel-item {
  transition: transform 0.6s ease-in-out;
}

/* Product Cards */
.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 1.5rem;
  padding: 0.5rem;
}

.product-card {
  background: white;
  border-radius: var(--radius);
  overflow: hidden;
  transition: var(--transition);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  height: 100%;
  display: flex;
  flex-direction: column;
}

.product-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.12);
}

.product-image {
  height: 200px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--light-gray);
  padding: 1rem;
}

.product-image img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  transition: var(--transition);
}

.product-card:hover .product-image img {
  transform: scale(1.05);
}

.product-info {
  padding: 1.2rem;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
}

.product-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: var(--dark);
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.product-description {
  color: var(--gray);
  font-size: 0.9rem;
  margin-bottom: 1rem;
  flex-grow: 1;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.product-price {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--primary);
  margin-bottom: 1rem;
}

.product-actions {
  display: flex;
  gap: 0.5rem;
}

.btn {
  padding: 0.5rem 1rem;
  border-radius: 6px;
  font-weight: 500;
  transition: var(--transition);
  border: none;
  cursor: pointer;
  font-size: 0.9rem;
  flex: 1;
  text-align: center;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 5px;
}

.btn-primary {
  background-color: var(--primary);
  color: white;
}

.btn-primary:hover {
  background-color: var(--primary-dark);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(67, 97, 238, 0.3);
}

.btn-outline {
  background-color: transparent;
  color: var(--primary);
  border: 1px solid var(--primary);
}

.btn-outline:hover {
  background-color: rgba(67, 97, 238, 0.1);
}

/* Carousel Controls */
.carousel-control-prev,
.carousel-control-next {
  width: 50px;
  height: 50px;
  background-color: white;
  border-radius: 50%;
  top: 50%;
  transform: translateY(-50%);
  opacity: 0.9;
  box-shadow: var(--shadow);
  transition: var(--transition);
}

.carousel-control-prev {
  left: -25px;
}

.carousel-control-next {
  right: -25px;
}

.carousel-control-prev:hover,
.carousel-control-next:hover {
  opacity: 1;
  transform: translateY(-50%) scale(1.05);
}

.carousel-control-prev-icon,
.carousel-control-next-icon {
  background-size: 20px 20px;
  background-color: var(--primary);
  border-radius: 50%;
  width: 30px;
  height: 30px;
}

/* Carousel Indicators */
.carousel-indicators {
  bottom: -45px;
}

.carousel-indicators li {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background-color: var(--light-gray);
  margin: 0 5px;
  transition: var(--transition);
}

.carousel-indicators .active {
  background-color: var(--primary);
  transform: scale(1.2);
}

/* Quantity Controls */
.quantity-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.quantity-btn {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  border: none;
  background: var(--light-gray);
  cursor: pointer;
  transition: var(--transition);
}

.quantity-btn:hover {
  background: var(--primary);
  color: white;
}

.quantity-value {
  font-weight: 600;
  min-width: 30px;
  text-align: center;
}

/* Responsive Design */
@media (max-width: 992px) {
  .product-grid {
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  }
  
  .flash-sale-header {
    flex-direction: column;
    gap: 1rem;
    text-align: center;
  }
}

@media (max-width: 768px) {
  .product-grid {
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 1rem;
  }
  
  .carousel-control-prev {
    left: 10px;
  }
  
  .carousel-control-next {
    right: 10px;
  }
  
  .product-actions {
    flex-direction: column;
  }
}

@media (max-width: 576px) {
  .product-grid {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .flash-sale-header h5 {
    font-size: 1.2rem;
  }
  
  .product-info {
    padding: 1rem;
  }
}

/* Animation for new items */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.product-card {
  animation: fadeInUp 0.5s ease forwards;
}

/* Badge for special offers */
.product-badge {
  position: absolute;
  top: 10px;
  right: 10px;
  background: var(--secondary);
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 0.75rem;
  font-weight: 600;
  z-index: 1;
}

.product-card-wrapper {
  position: relative;
}
</style>
{% endblock %}

{% block body %}
  {% load static %}
<div class="container">

    <!-- Slideshow starts here -->
    {% for product, range, nSlides in allProds %}
    <div class="flash-sale-header">
      <h5>Flash Sale on {{product.0.category}} - Recommended Items</h5>
      <div class="timer">
        <span>Sale ends in:</span>
        <span id="sale-timer-{{forloop.counter}}">23:59:59</span>
      </div>
    </div>
    
    <div class="carousel-container">
      <div id="demo{{forloop.counter}}" class="carousel slide" data-ride="carousel" data-interval="5000">
        <ul class="carousel-indicators">
          <li data-target="#demo{{forloop.counter}}" data-slide-to="0" class="active"></li>
          {% for i in range %}
          <li data-target="#demo{{forloop.parentloop.counter}}" data-slide-to="{{i}}"></li>
          {% endfor %}
        </ul>

        <div class="carousel-inner">
          <div class="carousel-item active">
            <div class="product-grid">
              {% for i in product %}
              <div class="product-card-wrapper">
                {% if forloop.counter <= 2 %}
                <div class="product-badge">Hot Deal</div>
                {% endif %}
                <div class="product-card">
                  <div class="product-image">
                    <img src='/media/{{i.image}}' alt="{{i.product_name}}">
                  </div>
                  <div class="product-info">
                    <h5 class="product-title" id="namepr{{i.id}}">{{i.product_name}}</h5>
                    <p class="product-description">{{i.desc|slice:"0:53"}}...</p>
                    <div class="product-price">$<span id="pricepr{{i.id}}">{{i.price}}</span></div>
                    <div class="product-actions">
                      <span id="divpr{{i.id}}" class="divpr">
                        <button id="pr{{i.id}}" class="btn btn-primary cart">
                          <i class="fas fa-shopping-cart"></i> Add To Cart
                        </button>
                      </span>
                      <a href="/shop/products/{{i.id}}">
                        <button id="qv{{i.id}}" class="btn btn-outline">
                          <i class="fas fa-eye"></i> Quick View
                        </button>
                      </a>
                    </div>
                  </div>
                </div>
              </div>
              {% if forloop.counter|divisibleby:4 and forloop.counter > 0 and not forloop.last %}
            </div>
          </div>
          <div class="carousel-item">
            <div class="product-grid">
              {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>

        <!-- Left and right controls for the slide -->
        <a class="carousel-control-prev" href="#demo{{forloop.counter}}" data-slide="prev">
          <span class="carousel-control-prev-icon"></span>
        </a>
        <a class="carousel-control-next" href="#demo{{forloop.counter}}" data-slide="next">
          <span class="carousel-control-next-icon"></span>
        </a>
      </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block js%}
<script>
// Timer functionality for flash sales
document.addEventListener('DOMContentLoaded', function() {
  // Initialize timers for each flash sale
  const timers = document.querySelectorAll('[id^="sale-timer-"]');
  timers.forEach(timer => {
    startCountdown(timer);
  });
});

function startCountdown(timerElement) {
  let time = 86399; // 23:59:59 in seconds
  const timerId = setInterval(() => {
    const hours = Math.floor(time / 3600);
    const minutes = Math.floor((time % 3600) / 60);
    const seconds = time % 60;
    
    timerElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    if (time <= 0) {
      clearInterval(timerId);
      timerElement.textContent = "Sale Ended";
      timerElement.style.color = "#dc3545";
    }
    
    time--;
  }, 1000);
}

// Cart functionality
if(localStorage.getItem('cart') == null){
    var cart = {};
} else {
    cart = JSON.parse(localStorage.getItem('cart'));
    updateCart(cart);
}

// Add to cart button click handler
$('.divpr').on('click', 'button.cart', function(){
    var idstr = this.id.toString();
    if(cart[idstr] != undefined){
        qty = cart[idstr][0] + 1;
        name = document.getElementById('name' + idstr).innerHTML;
        price = document.getElementById('price' + idstr).innerHTML;
        cart[idstr] = [qty, name, parseInt(price)];
    } else {
        qty = 1;
        name = document.getElementById('name' + idstr).innerHTML;
        price = document.getElementById('price' + idstr).innerHTML;
        cart[idstr] = [qty, name, parseInt(price)];
    }
    updateCart(cart);
    
    // Add animation feedback
    $(this).html('<i class="fas fa-check"></i> Added');
    setTimeout(() => {
        $(this).html('<i class="fas fa-shopping-cart"></i> Add To Cart');
    }, 1500);
});

// Update cart display
function updateCart(cart){
    var sum = 0;
    for (var item in cart) {
        sum = sum + cart[item][0];
        document.getElementById('div' + item).innerHTML = `
            <div class="quantity-controls">
                <button id='minus${item}' class='quantity-btn minus'>-</button>
                <span id='val${item}' class='quantity-value'>${cart[item][0]}</span>
                <button id='plus${item}' class='quantity-btn plus'>+</button>
            </div>
        `;
    }
    localStorage.setItem('cart', JSON.stringify(cart));
    document.getElementById('cart').innerHTML = sum;
    updatePopover(cart);
}

// Quantity button handlers
$('.divpr').on("click", "button.minus", function(){
    a = this.id.slice(5, );
    cart['pr' + a][0] = cart['pr'+a][0] - 1;
    cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
    if(cart['pr' + a][0] == 0) {
        document.getElementById('divpr' + a).innerHTML = '<button id="pr' + a + '" class="btn btn-primary cart"><i class="fas fa-shopping-cart"></i> Add To Cart</button>';
        delete cart['pr' + a];
    } else {
        document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
    }
    updateCart(cart);
});

$('.divpr').on("click", "button.plus", function(){
    a = this.id.slice(4, );
    cart['pr' + a][0] = cart['pr'+a][0] + 1;
    document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
    updateCart(cart);
});

// Popover functionality
$('#popcart').popover();
updatePopover(cart);

function updatePopover(cart){
    var popStr = "";
    popStr = "<h5>Your Shopping Cart</h5><div class='cart-popover'>";
    var i = 1;
    var total = 0;
    
    for(var item in cart){
        popStr += `<div class="cart-item">
            <span class="item-name">${i}. ${document.getElementById('name' + item).innerHTML.slice(0,19)}...</span>
            <span class="item-qty">Qty: ${cart[item][0]}</span>
            <span class="item-price">$${(cart[item][0] * cart[item][2]).toFixed(2)}</span>
        </div>`;
        total += cart[item][0] * cart[item][2];
        i++;
    }
    
    if(i === 1) {
        popStr += "<p>Your cart is empty</p>";
    } else {
        popStr += `<div class="cart-total">Total: $${total.toFixed(2)}</div>`;
    }
    
    popStr += `</div>
        <div class="cart-actions">
            <a href='/shop/checkout'><button class='btn btn-primary' id='checkout'>Checkout</button></a>
            <button class='btn btn-outline' onclick='clearCart()' id='clearCart'>Clear Cart</button>
        </div>`;
    
    document.getElementById('popcart').setAttribute('data-content', popStr);
}

function clearCart(){
    cart = JSON.parse(localStorage.getItem('cart'));
    for(var item in cart){
        document.getElementById('div' + item).innerHTML = '<button id="'+ item +'" class="btn btn-primary cart"><i class="fas fa-shopping-cart"></i> Add To Cart</button>';
    }
    localStorage.clear();
    cart = {};
    updateCart(cart);
    $('#popcart').popover('hide');
}

// Add hover effects to product cards
document.querySelectorAll('.product-card').forEach(card => {
    card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-5px)';
    });
    
    card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
    });
});
</script>
{% endblock %}